<!DOCTYPE html>
<html lang="en">
  <head>
  
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <!-- The above 3 meta tags *must* come first in the head; any other head content must come *after* these tags -->
    <title>Verify on boarding data</title>
    

    <!-- Bootstrap -->
    <link href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  </head>
  <body>

<?php include "header.php";?>
    <div class="form-group col-sm-12 text-center">
            
            <label>Delegated Task Instances:</label>
            <select multiple="" name="task_instances">
              
            </select>
    </div>
    
    <form class="col-sm-10 col-sm-offset-1 form-horizontal">
    <h1 class="text-center">Verify on boarding information</h1>
    <div class="panel panel-default">
      <div class="panel-heading"><h2 class="text-center"></h2></div>
    <div class="panel-body">
          
          <div class="form-group col-sm-6">
            <label for="inputName" class="col-sm-5 control-label">Client Name</label>
            <div class="col-sm-7">
              <input name="client_name" type="text" class="form-control" id="inputName" disabled="">
            </div>
            </div>

            <div class="form-group col-sm-6">
            <label for="inputEmail" class="col-sm-5 control-label">Client Email</label>
            <div class="col-sm-7">
              <input name="client_email" type="email" class="form-control" id="inputEmail" disabled="">
            </div>
            </div>

          </div>
      </div>
    
    
    <div class="form-group">
      <h3 class="text-center">Workspace information</h3>
    </div>
    <div class="panel panel-default">
      <div class="panel-heading"><h4 class="text-center">Development environment</h4></div>
    <div class="panel-body">

        <div class="form-group">
        <label for="inputWorkspaceID" class="col-sm-3 control-label">WorkspaceID</label>
        <div class="col-sm-7">
          <input name="workspace_id" type="text" class="form-control" id="inputWorkspaceID"  disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceName" class="col-sm-3 control-label">Workspace Name</label>
        <div class="col-sm-7">
          <input name="workspace_name" type="text" class="form-control" id="inputworkspaceName" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceurl" class="col-sm-3 control-label">Workspace url</label>
        <div class="col-sm-7">
          <input name="dev_workspace_url" type="text" class="form-control" id="inputworkspaceurl" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="license_file" class="col-sm-3 control-label">License file name</label>
        <div class="col-sm-7">
          <input name="dev_license_filename" type="text" class="form-control" id="license_file" disabled="">
        </div>
        </div>

        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">User Name</label>
          <div class="col-sm-7">
          <input name="username" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Password</label>
          <div class="col-sm-7">
          <input name="userpass" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
          <div class="form-group">
        <label for="additionalNotes" class="col-sm-3 control-label">Notes</label>
        <div class="col-sm-7">
          <textarea name="notes" disabled="" id="additionalNotes" class="form-control" rows="5"  ></textarea>
        </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Created by</label>
          <div class="col-sm-7">
          <input name="dev_created_by" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>

    </div>
    </div>

    <div class="panel panel-default">
      <div class="panel-heading"><h4 class="text-center">Sandbox environment</h4></div>
    <div class="panel-body">

        <div class="form-group">
        <label for="inputWorkspaceID" class="col-sm-3 control-label">WorkspaceID</label>
        <div class="col-sm-7">
          <input name="workspace_id" type="text" class="form-control" id="inputWorkspaceID"  disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceName" class="col-sm-3 control-label">Workspace Name</label>
        <div class="col-sm-7">
          <input name="workspace_name" type="text" class="form-control" id="inputworkspaceName" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceurl" class="col-sm-3 control-label">Workspace url</label>
        <div class="col-sm-7">
          <input name="san_workspace_url" type="text" class="form-control" id="inputworkspaceurl" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="license_file" class="col-sm-3 control-label">License file name</label>
        <div class="col-sm-7">
          <input name="san_license_filename" type="text" class="form-control" id="license_file" disabled="">
        </div>
        </div>

        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">User Name</label>
          <div class="col-sm-7">
          <input name="username" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Password</label>
          <div class="col-sm-7">
          <input name="userpass" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
          <div class="form-group">
        <label for="additionalNotes" class="col-sm-3 control-label">Notes</label>
        <div class="col-sm-7">
          <textarea name="notes" disabled="" id="additionalNotes" class="form-control" rows="5"  ></textarea>
        </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Created by</label>
          <div class="col-sm-7">
          <input name="san_created_by" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>

    </div>
    </div>
      
    <div class="panel panel-default">
      <div class="panel-heading"><h4 class="text-center">Production environment</h4></div>
    <div class="panel-body">

        <div class="form-group">
        <label for="inputWorkspaceID" class="col-sm-3 control-label">WorkspaceID</label>
        <div class="col-sm-7">
          <input name="workspace_id" type="text" class="form-control" id="inputWorkspaceID"  disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceName" class="col-sm-3 control-label">Workspace Name</label>
        <div class="col-sm-7">
          <input name="workspace_name" type="text" class="form-control" id="inputworkspaceName" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="inputworkspaceurl" class="col-sm-3 control-label">Workspace url</label>
        <div class="col-sm-7">
          <input name="prod_workspace_url" type="text" class="form-control" id="inputworkspaceurl" disabled="">
        </div>
        </div>

        <div class="form-group">
        <label for="license_file" class="col-sm-3 control-label">License file name</label>
        <div class="col-sm-7">
          <input name="prod_license_filename" type="text" class="form-control" id="license_file" disabled="">
        </div>
        </div>

        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">User Name</label>
          <div class="col-sm-7">
          <input name="username" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Password</label>
          <div class="col-sm-7">
          <input name="userpass" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>
          <div class="form-group">
        <label for="additionalNotes" class="col-sm-3 control-label">Notes</label>
        <div class="col-sm-7">
          <textarea name="notes" disabled="" id="additionalNotes" class="form-control" rows="5"  ></textarea>
        </div>
        </div>
        <div class="form-group">
          <label for="exampleInput3" class="col-sm-3 control-label">Created by</label>
          <div class="col-sm-7">
          <input name="prod_created_by" disabled="" type="text" class="form-control col-sm-7" id="exampleInput3" >
          </div>
        </div>

    </div>
    </div>

    <div class="panel panel-default">
     <div class="panel-heading"><h2 class="text-center">Requester information</h2></div>
    <div class="panel-body">
        
        <div class="form-group col-sm-6">
              <label for="inputRequesterName" class="col-sm-5 control-label">Requester Name</label>
              <div class="col-sm-7">
                <input name="requester_name" type="text" class="form-control" id="inputRequesterName" disabled="">
              </div>
              </div>

                <div class="form-group col-sm-6">
                <label for="inputRequesterEmail" class="col-sm-5 control-label">Requester Email</label>
                <div class="col-sm-7">
                  <input name="requester_email" type="email" class="form-control" id="inputRequesterEmail" disabled="">
                </div>
                </div>

      </div>
      </div>
      <div class="form-group text-center">
        <a class="btn btn-success confirm" data-confirm="1">Submit</a>
      </div>
      <div class="form-group text-center" >
        <a class="btn btn-success see_logs" style="">Show logs<span class="glyphicon glyphicon-forward"></span></a>
      </div>
</form>


    <center>
    <div class="col-sm-12 logging">
  <div class="panel panel-default ">
   <div class="panel-heading"><h4>Logging</h4></div>
    <div class="panel-body">
          <a href="#request" class="btn btn-info" data-toggle="collapse">Show request</a>
          <div id="request" class="collapse">
          <div class="form-group">
            <label>Request</label>
            <textarea name="request" rows="7" class="form-control"></textarea>
          </div>
          </div>
          <a href="#response" class="btn btn-info" data-toggle="collapse">Show response</a>
          <div id="response" class="collapse">
          <div class="form-group">
            <label>Response</label>
            <textarea name="response" rows="7" class="form-control"></textarea>
          </div>
          </div>
          <div class="form-group">
              <label>Host</label>
              <div class="input-group">
                <div class="input-group-addon">URL</div>
                <input name="host" type="text" class="form-control" value="">
                
              </div>
          </div>
          <div class="form-group">
            <label>Token key</label>
            <textarea name="token" class="form-control" rows="10"></textarea>
          </div>
    </div>
  </div>
</div>
</center>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.4/jquery.min.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js"></script>
    <script type="text/javascript">
    $(document).ready(function() {
      $(':input').val('');
      $('textarea').val();
      var host = 'http://<?php echo $host;?>/api/v1/';
      var token = '<?php echo $key;?>';
      var headers = 
      { 
        "content-type": "application/json",
        "Accept": "application/json",
        "Authorization": "Bearer "+token
      };
      $('input[name=host]').val(host);
      $('textarea[name=token]').val(token);
      var delegated_url = host+"task_instances/delegated?per_page=100&include=task";
      $.ajax({
        'url':delegated_url,
         dataType: 'json',
         type:'GET',
         cache: false,
         'headers':headers,
    }).success(function(response) {
          console.log(response);
          $('select[name=task_instances]').find('option')
    .remove();
          $('select[name=task_instances]').append('<option>Select Task Instance</option>');
          var count = 0;
          for (k in response.included) {
            if (response.included[k].attributes.name == "Verify Onboarding Data")
            {
              //Getting task_id of Record Customer
              var task_id = response.included[k].id;
              console.log(task_id);
              //Getting all task instances for that task
              for (k in response.data) {
                  console.log(response.data[k]);
                  if (response.data[k].attributes.task_id == task_id) {
                    $('select[name=task_instances]').append('<option class="'+count+'" value="'+response.data[k].id+'">'+count+'. '+response.data[k].id+'</option>');
                    count++;
                  }
              }
             

            }
          }
          if (count >0 ) $('select[name=task_instances] option.0').trigger('change').attr('selected', true);
          
      });

    $('select[name=task_instances]').on('change',function(){
      $('a.confirm').attr('disabled',false);
      var instance;
      if ($(this).val() == null) 
        instance = $('select[name=task_instances] option.0').val(); 
          else instance = $(this).val();
      if (instance == 'Select Task Instance') 
        {
        $('a.confirm').attr('disabled',true);
        $(':input').val('');
        $('textarea').val();
        $(':checkbox').attr('checked', false);
        return;
        }
      /* Getting DATA from server */

      var url = host+"task_instances/"+instance;
  
      $.ajax({
        'url':url,
         dataType: 'json',
        'type':'GET',
        'cache': false,
        'headers':headers,
    }).success(function(response) {
          console.log(response);
          var workspace = response.included[0].attributes.content.workspace;
          //console.log(items);
          /*Filling in our fields */
          var others = response.included[0].attributes.content;
          for (key in workspace) {
            if (key == 'notes') $('textarea[name=notes]').val(workspace[key]);
            if (key == 'Environment requested') continue;
            $('input[name='+key+']').val(workspace[key]);
          }
          
          for (k in others) {
          if (k == 'final_notes') { $('textarea[name=notes]').val(others[k]);}
          if (k == 'dev' || k=='prod' || k=='san') {
              for (k1 in others[k]) {
                $("input[name="+k+'_'+k1+"]").val(others[k][k1]);
              }
            }
          }
          
      });

    });

    $('body').on('click','a.confirm',function(){
      var task_instance = $('body').find('select[name=task_instances]').val();
      console.log(task_instance);
      var instance_update_url = host+"task_instances/"+task_instance;
      var items ={};
      items['on_board_data_valid'] = Number($('a.confirm').data('confirm'));
      items['customer_name'] = $('input[name=client_name]').val();
      items['customer_email'] = $('input[name=client_email]').val();
      var data = {
          'data': {
            'type':'task_instance',
            'attributes': {
              'status':'COMPLETE',
                'content':items
            }
          }
        };
        data = JSON.stringify(data);
        //console.log(data);
        /*Logging request*/
              $('textarea[name=request]').html();
              $('textarea[name=request]').val('Sending to: \n'+instance_update_url+'\nData in JSON: \n'+data); 
              
         /*Logging request*/
        $.ajax({
        'url':instance_update_url,
         'data': data,
         dataType: 'json',
        'type':'PATCH',
        'cache': false,
        'headers':headers,
    }).success(function(response) {
          console.log(response.data);
          /*Logging response*/
              $('textarea[name=response]').html();
              $('textarea[name=response]').val('Response from: \n'+instance_update_url+'\nData in JSON: \n'+JSON.stringify(response.data)); 
              /*Logging response*/
              alert('On boarding info sended');
              $('a.see_logs').fadeIn(500);
      });
  });

    
    $('body').on('click','a.see_logs',function(){
      var log_url = host+'logs'
      $.ajax({
        'url':log_url,
         dataType: 'json',
         type:'GET',
         cache: false,
         'headers':headers,
    }).success(function(response) {
        //console.log(response);
        /*Logging response*/
              $('textarea[name=response]').html();
              $('textarea[name=response]').val('Response from: \n'+log_url+'\nData in Plain text: \n'+response.content); 
        /*Logging response*/
    });

    });


    });

    </script>
  </body>
</html>